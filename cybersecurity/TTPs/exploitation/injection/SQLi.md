# SQL Injection Attack
A vulnerability which allows an attacker to submit malicious [SQL](../../../../coding/languages/SQL.md) queries to a database via an insecure application or website. SQLi is usually leveraged to: view protected data, modify or delete data, compromise the underlying server or back end such as in a [denial of service](../denial-of-service.md) attack.
## Basic Mechanism
SQL is a *standard for languages* whose function is to manage data in *[RDBMS](../../../../coding/databases/RDBMS.md)* (relational databases) put forth by ISO. Different SQL languages exist (such as MySQL) and they all must follow the ISO standards for accessing, inserting, modifying, and deleting data, as well as for managing users and user authorization.
### In Web Apps
Many web applications use SQL databases to manage data related to users, products, and other kinds of data. Normally, when a client interacts with the frontend, data from the interaction is sent to the backend [application layer](../../../../networking/OSI/7-application/application-layer.md) running on the server. The backend code interacts with the data being sent from the front end and usually functions as a handler between the data and the database where it may be stored. This backend code/ framework will also handle data from the database being requested by the front end.

For example, when a user logs into a website, a request needs to be made from the front end to the backend to validate the supplied username and password. The user's credentials are likely stored in the database, so the backend will likely retrieve or query the existing user's information and compare the values supplied by the client (to decide whether the user attempting to login has supplied the correct credentials).
### Syntax
The most common languages used for relational databases are MySQL, Microsoft SQL, PostgresQL, and Oracle. Each vary in their syntax but they all do the same things regarding data and databases. The following is an example of a MySQL query for parsing the `users` table to retrieve a specific user entry:
```mysql
SELECT * FROM users WHERE user_name='tiddies'
```
## Techniques
1. Modifying an SQL query to retrieve hidden data or additional results
2. Subverting the logic of the application by changing a query in a way that interfere's with the application's logic.
3. Extracting information about the database itself including its structure, version etc.
4. blind-SQLi where the results of a query are not returned in the application's response.
### UNION Attack
A [UNION attack](cybersecurity/TTPs/exploitation/injection/UNION-attack.md) can be used to retrieve data from a database table other than the one you're attacking from.
## Attack-flow example (retrieving hidden data)
A shopping application displays data about products in different categories. When a user clicks on the "gifts" categories, their browser requests the URL `https://insecure-website.com/products?category=Gifts` the application makes an SQL query to its database to retrieve information of the relevant products:
```sql
SELECT * FROM products WHERE category = `Gifts` AND released = 1
```
- `*` asks for 'all details' from the `products` table
- where the category is `Gifts` is present
- and `released` (a property of each product) is `1` (true) (hides products which are not released)
Assume unreleased products = `0`. An attacker can construct an attack using a similar URL: `https://insecure-website.com/products?category=Gifts --` which would result in the SQL query looking like:
```sql
SELECT * FROM products WHERE category = `Gifts`--` AND released = 1
```
The `--` is a comment indicator in SQL and would comment result in everything after it being commented out (not executable). This removes the rest of the query so that `AND released = 1` is no longer included.

If the attacker manipulates their input further, they can construct a URL which will show them all the products, including ones which are not meant to be seen: `https://insecure-website.com/products?category=Gifts'+OR+1=1--`. The resulting query would be:
```sql
SELECT * FROM products WHERE category = 'Gifts' OR 1=1--' AND released = 1
```
This query returns all items where either the category is `Gifts` or 1 is equal to 1, and since 1=1 is always true, the query returns ALL ITEMS.

> [!References]
> - [Port Swigger](https://portswigger.net/web-security/sql-injection)


**boolean-based blind, time-based blind, error-based, UNION query-based, stacked queries and out-of-band**.