
# Cross-Site Scripting (XSS):
Cross Site Scripting or 'XSS' is a *client side* injection of malicious code into a website. The code is executed when the victim visits the website and the page is loaded. The code is usually JavaScript code which runs on the user's machine to generate the website they're visiting.

Since a lot of code is ran on the client-side in order to generate a website's various pages, XSS has become a very common vulnerability.
## Basic Method
XSS is commonly carried out using [JavaScript](/coding/languages/javascript.md) b/c, not only is it used in nearly every website, it has *access to sensitive data such as user cookies*. JS can also be used to *make [HTTP](/networking/protocols/HTTP.md) requests* which can be used to send data (back to the attacker). Other data which can be accessed using JS includes APIs, geolocation, webcam data, etc..
### Typical Attack Flow:
1. Attacker creates a post/ content which will be displayed to anyone who visits the specific webpage. The post contains malicious code which will be executed when the webpage loads.
2. A victim visits the webpage where the attacker's post is being displayed. The malicious code in the post is executed by the victim's browser.
3. The malicious code exfiltrates sensitive data (such as a cookie) about the user and sends it via an HTTP request to an attacker-controlled server.
4. The attacker receives the user-cookie and *uses it to impersonate the user* on the website.
### An Example
Websites which display user-generated content can be vulnerable to XSS. One common example is a website which includes comment forums. If the comments from users *are not validates/ sanitized* an attacker can easily include malicious code in a comment which will then be executed *on other people's browsers* when they visit the page and load the comment forums.

An example comment could simply include [HTML](/coding/languages/HTML.md) `<script>` tags, and if placed/ injected correctly into the DOM, the script inside the tags will execute *for every browser which visits the forum and loads the malicious comment*.
## Types of XSS
Types of XSS can be organized into *client* vs *server XSS* based on where the malicious data is stored. The two most common types of XSS are *Reflected* and *Persistent*, with reflected being the most common of the two.
![](/cybersecurity/cybersecurity-pics/xss-1.png)
> [OWASP](https://owasp.org/www-community/Types_of_Cross-Site_Scripting)
### Reflected
In reflected XSS the vulnerable application receives data in an HTTP request and then responds to that request *with the same data included in the response.* 

For example, a vulnerable URL to a legitimate website might include a search parameter supplied by the user:
```URL
https://example-website.com/search?term=jewelry
```
In a search like this, the website likely *responds* w/ HTML like this:
```HTML
<p>You searched for: jewelry</p>
```
If the application doesn't take any measures to sanitize the original user-supplied search term, then an attacker can take advantage of this and replace the term *in the URL* w/ malicious code:
```url
https://example-website.com/search?term=<script>malicious code here</script>
```
Reflected XSS *is delivered to the victim by an outside route* like as a malicious URL in a [phishing](/cybersecurity/TTPs/delivery/phishing.md) email. The malicious code is *appended to the end of a legitimate URL* and the URL is sent to the victim. When the victim clicks the link, the malicious code at the end of the URL is executed.

This type of XSS is referred to as 'reflected' because the mechanism *requires that the user-supplied input is returned to the browser as part of the server's response.*
### Persistent/ Stored
Persistent XSS (also called 'stored') is usually achieved by taking advantage of sites which *display user-provided content*. If the site doesn't properly *sanitize user input*, malicious code added by an attacker will make it into the HTML replicated across anyone's browser who visits the site (where the attacker's post is).

This also means the *malicious input is stored on the server*. However, with HTML5 it is possible it will never be stored on the server and will instead be stored on client browsers.

Example:
Let's pretend this is a post from the attacker on a dating site, where other users can see their post:
```
'Hi! My name is Johnny and I'm definitely not a creep. I'm a normal person, and I love dogs or whatever <script>malicious code here</script>
```
#### Blind XSS
Blind XSS is a type of stored XSS where *the attacker can't access the exit point of the data.* Usually, this type of XSS is done 'blindly' as in the attacker attempts to inject malicious code in several places on a web application w/o being able to see or check that it actually was a successful injection.

Commonly, the malicious data gets stored in a database or server and may not be executed immediately. Therefor, the attacker has no idea where their data was stored, or if it will even be executed.

For example, if an attacker submits a feedback form w/ a malicious script as part of its content, the script may not execute until someone on the backend of the application opens the submitted form to read it.
##### Tools to Detect Successful Blind XSS:
1. [KnoXSS](https://knoxss.me/)
2. [XSS Hunter](https://github.com/mandatoryprogrammer/xsshunter-express)
3. [bXSS Hunter](https://bxsshunter.com/)
### DOM Based
DOM based XSS requires user-supplied, malicious code to pass through a *sink*. A "sink" is JavaScript function or a DOM object that can cause undesirable effects if malicious data is passed to it. For example, the JS `eval()` method is considered a sink *because it processes the input given to it as JS*.

An HTML version of a sink is *`documnet.body.innerHTML`* b/c it could be given malicious HTML such as a `<script>` element and will execute the JavaScript inside it.

The *most common* sink in DOM based XSS attacks is the `location` property on the `window` on the DOM. If an attacker crafts a malicious URL and is able to inject it somewhere in the code so that `location` gets set to their URL, then the browser will be redirected to that URL.
#### Other Examples of Common Sinks:
1. `document.URL`
2. `document.documentURI`
3. `document.URLEncoded`
4. `document.baseURI`
5. `location`
6. `document.cookie`
7. `document.referrer`
8. `window.name`
9. `history.pushState`
10. `history.rreplaceState`
11. `localStorage`
12. `sessionStorage`
13. `IndesedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)`
14. `Database`

> [!Resources]
> - [Cloudflare: XSS](https://www.cloudflare.com/learning/security/threats/cross-site-scripting/)
> - [OWASP: Reflected XSS](https://owasp.org/www-community/attacks/xss/#reflected-xss-attacks)
> - [PortSwigger: Reflected XSS](https://portswigger.net/web-security/cross-site-scripting/reflected)
> - [PortSwigger: Dom-based](https://portswigger.net/web-security/dom-based)
> - [OWASP: Types of XSS](https://owasp.org/www-community/Types_of_Cross-Site_Scripting)
> - [Geeks for Geeks: Blind XSS](https://www.geeksforgeeks.org/understanding-blind-xss-for-bug-bounty-hunting/#)





