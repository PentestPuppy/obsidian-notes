
# Insecure Direct Object Forgery
IDOR is an *access control* vulnerability in which an application is insecurely configured to use *user-controlled* data to access objects directly. An example of this is a web URL for a user profile using the user's ID number (likely stored in the backend) as part of the URL:
```http
https://example-website.com/customer_account?customer_number=69695
```
In this example, the user's ID is *used directly in the query* which is sent to the backend database. An attacker can take advantage of this by *modifying the `customer_number`* to access accounts/ view the records for other users.

Theoretically, if there are no access-control measures in place, an attacker can manipulate the `customer_number` to perform *privilege escalation*.
## Types of IDOR
The following are some examples where an application can be vulnerable to IDOR:
### Database Records
The value of a parameter is used to *directly retrieve* a record/ data from a database.
```http
http://foo.bar/somepage?invoice=12345
```
### Operations in the System
The value of a parameter is directly used to *perform operations* in the application/ system. Anywhere that user or object properties are used and/or passed between functions in the application might be vulnerable to IDOR.

For example, if the operation the application wants to perform is *changing the user's username*, the new username will likely be a parameter that the *user has control of*. If the input of this parameter for the operation is exposed to the user, than it can be used to perform IDOR:
```http
http://foo.bar/changeusername?name=new_user_name
```
### Application Functionality
The value of a parameter used in the logic of the application is exposed and can be changed by the user. This type of IDOR is similar to the last but differs in that the parameter is *part of the regular logic flow of the app*.

For example, if the web application displays items to be bought, and clicking on an item brings you to the item's page, the query to the backend might read like this in the URL:
```http
http://shop_site/object_page?object=14
```
In this example, the object's number is being used to *tell the application which item is being accessed* and therefor *what action to take next.* If there is no other access-control restrictions, a user could just change the number and potentially access other items which they should not be allowed to access.
### File System Resources
The value of the parameter is used to retrieve a resource from the file system. For example, if the query for an image looks like this:
```http
http://site.com/showImage?img=img0069
```
A user could simply manipulate the image number and potentially access the images of other users.

This type of IDOR is commonly *used in conjunction with* other directory/ path traversal vulnerabilities like [LFI](/cybersecurity/vulnerabilities/LFI.md).
### Unsuspecting Places to Look:
#### Encoded/ Hashed IDs
When the vulnerable parameter is encoded or hashed, it's possible that the encoding or hashing algorithm is *weak* and can be broken. You can also attempt to *manipulate the creation of the ID* (instead of targeting the ID itself).
#### Randomized IDs
When IDs are randomized, it's still possible to find *a pattern in the randomization* which may be easy to break. Creating multiple test accounts to see how a user-ID is randomized (for example) might illuminate some patterns. Once a pattern is discovered, ID randomization becomes predictable.

**Additionally** if the randomized ID is static for that object, then it *can be used to leak other information*. For example, if a randomized user ID is used in a query to find messages they've shared with another user at one endpoint of an application, it's likely the same user's ID is used elsewhere throughout the application.

*Using the encoded/randomized ID* as a static value in other locations can reveal more restricted information.
#### Creating or Supplying Data Values
When it seems like an application doesn't create or take parameter values from the user *try anyways*. For example, if a URL looks like this:
```http
GET /api/messages
```
... try appending data to the query to see if you can manipulate what's being queried for:
```http
GET /api/messages?user_id=ANOTHER_USER_ID
```
## Testing For IDOR
### User-Controlled Data
The first thing to do to test for IDOR is to map out an application and *find all the places where user-input is taken*. If the user-input/ user-controlled data is used to *directly reference an object*, then IDOR is in play.
### Modifying the Parameter
Once a parameter or value is found which might be vulnerable to IDOR, a tester can manipulate the value to see if it allows them to gain access to other instances of that object.

For example, if you find a parameter/ value which is used to directly reference a user object like this:
```http
http://foo.bar/changepassword?user=someuser
```
You can try different values for the `someuser` value of the `user` parameter to see if you can change the password of a *different, victim user.*

> [!Resources]
> - [PortSwigger: IDOR](https://portswigger.net/web-security/access-control/idor)
> - [OWASP: Testing for IDOR](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References)
> - [HackTricks: IDOR](https://book.hacktricks.xyz/pentesting-web/idor)